{"version":3,"file":"/packages/headers.js","sources":["headers/headers-common.js","headers/headers-server.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA,W;AACA,U;AACA,e;AACA,wB;AACA,gD;AACA,G;AACA,oC;AACA,iD;AACA,wC;AACA,gC;AACA,8C;AACA,G;AACA,sC;AACA,+B;AACA,G;AACA,4B;AACA,yB;AACA,E;AACA,C;;;;;;;;;;;;;;;;;;;AClBA,sC;AACA,sD;AACA,kC;AACA,6B;;AAEA,e;AACA,mB;AACA,sC;AACA,qE;AACA,6C;AACA,O;AACA,yB;AACA,mE;AACA,+C;AACA,iD;;AAEA,gB;AACA,G;;AAEA,gB;AACA,sC;AACA,iC;AACA,M;AACA,iC;AACA,yB;AACA,K;AACA,G","sourcesContent":["headers = {\n\tlist: {},\n\tproxyCount: 0,\n\tget: function(header) {\n\t\treturn header ? this.list[header] : this.list;\n\t},\n\tgetClientIP: function(proxyCount) {\n\t\tvar chain = this.list['x-ip-chain'].split(',');\n\t\tif (typeof(proxyCount) == 'undefined')\n\t\t\tproxyCount = this.proxyCount;\n\t\treturn chain[chain.length - proxyCount - 1];\n\t},\n\tsetProxyCount: function(proxyCount) {\n\t\tthis.proxyCount = proxyCount;\n\t},\n\tgetProxyCount: function() {\n\t\treturn this.proxyCount;\n\t}\n}\n","var app = typeof WebApp != 'undefined'\n  ? WebApp.connectHandlers : __meteor_bootstrap__.app;\napp.use(function(req, res, next) {\n  headers.list = req.headers;\n\n  // freebie :)\n  var ipChain = [];\n  if (headers.list['x-forwarded-for'])\n    _.each(headers.list['x-forwarded-for'].split(','), function(ip) {\n      ipChain.push(ip.replace('/\\s*/g', ''));\n    });\n  if (ipChain.length == 0\n      || ipChain[ipChain.length-1] != req.connection.remoteAddress)\n    ipChain.push(req.connection.remoteAddress);\n  headers.list['x-ip-chain'] = ipChain.join(',');\n\n  return next();\n});\n\nMeteor.methods({\n    'getReqHeader': function(header) {\n    \treturn headers.list[header];\n    },\n    'getReqHeaders': function() {\n    \treturn headers.list;\n    }\n});\n"]}